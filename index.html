<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Check-App: Professional Multi-Test</title>
    <style>
        :root { --elnusa-red: #ce2029; --elnusa-grey: #222; }
        body { 
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--elnusa-grey); color: white; 
            user-select: none; overflow: hidden;
        }
        #app { 
            width: 100%; height: 100%; text-align: center; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; 
            cursor: pointer; transition: background-color 0.2s;
        }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; max-width: 400px; margin-top: 20px; }
        .color-box { 
            height: 120px; display: flex; justify-content: center; align-items: center; 
            border-radius: 15px; font-weight: bold; font-size: 1.3rem; color: #fff; 
            text-shadow: 1px 1px 4px rgba(0,0,0,0.6); border: 3px solid rgba(255,255,255,0.1);
        }
        h1 { font-size: 2.2rem; margin: 10px; pointer-events: none; }
        h2 { font-size: 1.8rem; margin: 10px; color: #ffeb3b; pointer-events: none; }
        p { pointer-events: none; font-size: 1.1rem; }
        .instruksi { 
            font-size: 1.1rem; background: rgba(255,255,255,0.15); padding: 12px 25px; 
            border-radius: 50px; margin-top: 25px; margin-bottom: 20px; pointer-events: none; 
            border: 1px solid rgba(255,255,255,0.3); font-weight: bold;
        }
        .target-word { font-weight: 800; text-decoration: underline; color: #ffeb3b; }
        .footer { position: absolute; bottom: 20px; font-size: 0.8rem; opacity: 0.5; pointer-events: none; }
        .info-box {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; 
            text-align: left; max-width: 85%; margin: 10px auto; line-height: 1.5; font-size: 0.95rem;
        }
    </style>
</head>
<body>

<div id="app" onclick="handleGlobalClick()">
    <div id="content">
        <h1>DAILY CHECK-APP</h1>
        <p>Aplikasi Uji Kesiapan & Fokus AMT</p>
        <p style="color: #f1c40f; font-size: 0.9rem;">*Status: Experimental Prototype</p>
        <div class="instruksi">Ketuk untuk Lanjut ➔</div>
    </div>
    <div class="footer">Graduat Trainee 2025 Expertise Project - Elnusa Petrofin</div>
</div>

<script>
    // --- KONFIGURASI APPSHEET TEGAR ---
    const CONFIG = {
        appId: "d5d76776-2503-4577-8697-4a87c1898b56",
        view: "Check-App",
        table: "Log Checkup",
        colReaction: "Reaction Time",
        colStroopScore: "stroop test",
        colStroopSpeed: "Kecepatan Stroop Test" 
    };

    const colors = [
        { name: 'MERAH', hex: '#ff4d4d' },
        { name: 'BIRU', hex: '#4d94ff' },
        { name: 'HIJAU', hex: '#2ecc71' },
        { name: 'KUNING', hex: '#f1c40f' }
    ];

    // Perubahan State: Menambahkan jeda dan instruksi
    let state = 'WELCOME'; 
    let reactionTimes = [];
    let gridTargets = [];
    let gridResults = { correct: 0 };
    let startTime, timeoutId, gridStartTime;
    let gridCount = 0;
    const MAX_GRID = 5;

    const app = document.getElementById('app');
    const content = document.getElementById('content');

    function handleGlobalClick() {
        if (state === 'WELCOME') {
            showReactionIntro();
        } else if (state === 'REACTION_INTRO') {
            startReaction();
        } else if (state === 'WAITING') {
            tooEarly();
        } else if (state === 'READY') {
            finishReaction();
        } else if (state === 'REACTION_RESULT') {
            if (reactionTimes.length < 3) {
                startReaction();
            } else {
                showStroopIntro();
            }
        } else if (state === 'STROOP_INTRO') {
            state = 'GRID_PLAYING';
            startGrid();
        }
    }

    // --- REACTION TEST ---
    function showReactionIntro() {
        state = 'REACTION_INTRO';
        app.style.background = '#222';
        content.innerHTML = `
            <h2>1. TES REAKSI</h2>
            <div class="info-box">
                <ol style="padding-left: 20px; margin: 0;">
                    <li style="margin-bottom: 10px;">Layar akan berwarna <b>MERAH</b>.</li>
                    <li style="margin-bottom: 10px;">Fokus dan tunggu sampai layar berubah <b>HIJAU</b>.</li>
                    <li>Segera sentuh layar <b>DI MANA SAJA</b> secepat mungkin!</li>
                </ol>
            </div>
            <div class="instruksi">Ketuk untuk MULAI Tes ➔</div>
        `;
    }

    function startReaction() {
        state = 'WAITING';
        app.style.background = '#ce2029';
        content.innerHTML = `<h1>ROUND ${reactionTimes.length + 1} / 3</h1><p>Tunggu sampai warna HIJAU...</p>`;
        let delay = Math.floor(Math.random() * 3000) + 2000;
        timeoutId = setTimeout(() => {
            state = 'READY';
            app.style.background = '#32cd32';
            content.innerHTML = "<h1>SEKARANG!</h1><p>Sentuh layar di mana saja!</p>";
            startTime = Date.now();
        }, delay);
    }

    function tooEarly() {
        clearTimeout(timeoutId);
        state = 'REACTION_RESULT'; // Berhenti sejenak, jangan langsung mulai lagi
        app.style.background = '#222';
        content.innerHTML = `
            <h1 style="color: #ff4d4d;">TERLALU CEPAT!</h1>
            <p>Anda menyentuh layar sebelum hijau.</p>
            <div class="instruksi">Ketuk untuk Mengulang Round ${reactionTimes.length + 1} ➔</div>
        `;
    }

    function finishReaction() {
        let time = Date.now() - startTime;
        reactionTimes.push(time);
        state = 'REACTION_RESULT'; // Memberikan jeda sebelum round berikutnya
        app.style.background = '#222';
        
        let nextText = reactionTimes.length < 3 ? `Lanjut Round ${reactionTimes.length + 1}` : "Lanjut ke Tes Konsentrasi";
        content.innerHTML = `
            <h1>${time} ms</h1>
            <p>Kecepatan Reaksi Anda</p>
            <div class="instruksi">${nextText} ➔</div>
        `;
    }

    // --- GRID (STROOP) TEST ---
    function showStroopIntro() {
        state = 'STROOP_INTRO';
        app.style.background = '#222';
        const avg = Math.round(reactionTimes.reduce((a, b) => a + b) / 3);
        
        content.innerHTML = `
            <p style="color: #2ecc71; font-weight: bold;">Rata-rata Reaksi Anda: ${avg}ms</p>
            <h2>2. TES KONSENTRASI</h2>
            <div class="info-box">
                <p style="margin-top:0;"><b>TUGAS ANDA:</b> Klik KOTAK yang warnanya sesuai permintaan, <b>ABAIKAN</b> tulisan di dalamnya!</p>
                <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; text-align: center; border: 1px dashed #fff;">
                    <i>Contoh: Jika diminta kotak <span class="target-word">MERAH</span>,<br>klik kotak yang warnanya merah, meskipun tulisannya "BIRU".</i>
                </div>
            </div>
            <div class="instruksi">Ketuk untuk MULAI Tes ➔</div>
        `;
    }

    function startGrid() {
        gridStartTime = Date.now();
        gridTargets = [...colors, colors[Math.floor(Math.random() * colors.length)]];
        gridTargets.sort(() => 0.5 - Math.random());
        nextGrid();
    }

    function nextGrid() {
        if (gridCount >= MAX_GRID) {
            finishAll();
            return;
        }
        const target = gridTargets[gridCount];
        const shuffledBoxes = [...colors].sort(() => 0.5 - Math.random());
        const shuffledLabels = [...colors].sort(() => 0.5 - Math.random());

        content.innerHTML = `
            <div class="instruksi" style="margin-top: 0; margin-bottom: 10px; padding: 10px 20px;">
                Pilih KOTAK warna: <span class="target-word">${target.name}</span>
            </div>
            <div class="grid-container" onclick="event.stopPropagation()">
                ${shuffledBoxes.map((c, i) => `
                    <div class="color-box" style="background-color: ${c.hex}" onclick="checkGrid('${c.name}', '${target.name}')">
                        ${shuffledLabels[i].name}
                    </div>
                `).join('')}
            </div>
            <p style="margin-top:20px; opacity:0.5">Soal ${gridCount + 1} dari ${MAX_GRID}</p>
        `;
    }

    function checkGrid(clickedColor, targetColor) {
        if (clickedColor === targetColor) gridResults.correct++;
        gridCount++;
        nextGrid();
    }

    // --- FINISH ---
    function finishAll() {
        state = 'FINISHED';
        const avgReaction = Math.round(reactionTimes.reduce((a, b) => a + b) / 3);
        const totalGridTimeSeconds = (Date.now() - gridStartTime) / 1000;
        const avgGridSpeed = (totalGridTimeSeconds / MAX_GRID).toFixed(2);
        
        app.style.background = '#111';
        content.innerHTML = `
            <h1>SELESAI</h1>
            <p>Rata-rata Reaksi: ${avgReaction}ms</p>
            <p>Skor Konsentrasi: ${gridResults.correct}/${MAX_GRID} Benar</p>
            <p>Kecepatan Pilih: ${avgGridSpeed} detik/soal</p>
            <p style="color: #2ecc71; margin-top: 20px; font-weight: bold;">Menyimpan data ke AppSheet...</p>
        `;

        const dataValues = {
            [CONFIG.colReaction]: avgReaction,
            [CONFIG.colStroopScore]: gridResults.correct,
            [CONFIG.colStroopSpeed]: avgGridSpeed
        };

        const url = `https://www.appsheet.com/start/${CONFIG.appId}#control=${encodeURIComponent(CONFIG.view)}&table=${encodeURIComponent(CONFIG.table)}&defaults=${encodeURIComponent(JSON.stringify(dataValues))}`;
        
        setTimeout(() => { window.location.href = url; }, 2500);
    }
</script>
</body>
</html>

